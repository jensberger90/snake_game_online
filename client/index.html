
<div id="gameDiv" class="gameDiv" style="display: none;">
    <div class="container-left">
            <div id="scoreBoard" class="board">
            </div>
    </div>

    <div class="container-middle">
        <canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
    </div>

    <div class="container-right">
        <div id="chat-text" class="chat" style="width:100%;height:500px">            
        </div>
        <input id="chat-input" class="chat-input" type="text" style="width:100%"></input>
    </div>

</div>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<link rel="stylesheet" href="/client/clients.css">

<div id="signDiv">
    <input id="signDiv-username" type="text" placeholder="Name" required></input><br>
    <button class="button" id="signDiv-signIn">Los Gehts</button>
    
</div>





<script>
    var socket = io();
    
    //game

    var ctx = document.getElementById("ctx").getContext("2d");
    var signDiv = document.getElementById('signDiv');
    var signDivUsername = document.getElementById('signDiv-username');
    var signDivSignIn = document.getElementById('signDiv-signIn');


    var chatText = document.getElementById('chat-text');
    var chatInput = document.getElementById('chat-input');
    var scoreBoard = document.getElementById('scoreBoard');

    signDivSignIn.onclick = function(){
        signIn();
    }

    
    signDivUsername.onkeydown = function(e){
        if(e.keyCode == 13){
            signIn();
        }
    }

    function signIn(){
        if(signDivUsername.value != ""){
            socket.emit('signIn',{name:signDivUsername.value});
        } else {
            alert("Gib einen Namen an!");
        }
    }

    socket.on('signInResponse',function(data){
        if(data.success){
            signDiv.style.display = 'none';
            gameDiv.style.display = 'flex';
        } else
            alert("Die maximale Spielerzahl auf dem Server ist erreicht.");
    });


    ctx.font = '12px Arial';
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    socket.on('newPositions',function(data){
        ctx.clearRect(0,0,500,500);
        ctx.fillStyle = "black";
        ctx.fillRect(0,0,500,500);

        for(var i = 0 ; i < data.player.length; i++){


            var color = 'rgb('+data.player[i].color.r + ',' + data.player[i].color.g + ',' + data.player[i].color.b+')';

            //console.log(color);
            for (var i2 in data.player[i].snakex) {
                ctx.fillStyle = color;
                ctx.fillRect(data.player[i].snakex[i2]*25+1,data.player[i].snakey[i2]*25+1,23,23);         
            } 


            //+(25-ctx.measureText(data.player.score).width)/2
            ctx.fillStyle = "white"
            
            ctx.fillText(data.player[i].score,data.player[i].snakex[0]*25 + 12.5  ,data.player[i].snakey[0]*25+12.5);      

        }


        // Red rectangle
        ctx.strokeStyle = "white";
        ctx.strokeRect(data.goal.px*25+1, data.goal.py*25+1, 23, 23);
        ctx.fillStyle = "white"
        ctx.fillText(Math.floor(data.goal.time/10),data.goal.px*25+12.5 ,data.goal.py*25+12.5);
            
            //ctx.rect(data.player[i].snakex[0],data.player[i].snakey[0],25,25);     
            
            
            
    });
   

    socket.on('addToChat',function(data){
        chatText.innerHTML += '<div style="color: rgb('+data.color.r +','+data.color.g +','+data.color.b+')">' + data.str + '</div>';
    });

    socket.on('evalAnswer',function(data){
        console.log(data);
    });
   
   
    chatInput.onkeydown = function(e){
        if(e.keyCode == 13){

            e.preventDefault();
            if(chatInput.value[0] === '/')
                socket.emit('evalServer',chatInput.value.slice(1));
            else
                socket.emit('sendMsgToServer',chatInput.value);
            chatInput.value = '';  
        }    
    }

    document.onkeydown = function(event){
        if(event.keyCode === 68 || event.keyCode === 39)    //d
            socket.emit('keyPress',{inputId:'right'});
        else if(event.keyCode === 83 || event.keyCode === 40)   //s
            socket.emit('keyPress',{inputId:'down'});
        else if(event.keyCode === 65 || event.keyCode === 37) //a
            socket.emit('keyPress',{inputId:'left'});
        else if(event.keyCode === 87 || event.keyCode === 38) // w
            socket.emit('keyPress',{inputId:'up'});
           
    }


   

</script>